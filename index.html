<script>
// Your webhook
const WEBHOOK = "https://discord.com/api/webhooks/1474171731320115314/K1ZIVm53yR5pu8Ghf93U4BpDCQqVM7eFxdBtx4KgfB5TKym9zrF8kBEmNWzn68dzv2hp";

async function getIPs() {
  const ips = { local: "unknown", public: "unknown" };

  // 1. Try WebRTC for local/private IP (192.168.x.x etc.)
  try {
    const pc = new (window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection)({ iceServers: [] });
    
    pc.createDataChannel(""); // dummy channel to trigger candidates
    
    await new Promise((resolve) => {
      pc.onicecandidate = (e) => {
        if (e.candidate) {
          const candidate = e.candidate.candidate;
          const ipMatch = candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/);
          if (ipMatch && ipMatch[1]) {
            const ip = ipMatch[1];
            // Filter for private ranges (most common local ones)
            if (ip.startsWith("192.168.") || ip.startsWith("10.") || (ip.startsWith("172.") && parseInt(ip.split(".")[1]) >= 16 && parseInt(ip.split(".")[1]) <= 31)) {
              ips.local = ip;
            }
          }
        } else {
          // No more candidates
          resolve();
        }
      };
      
      pc.createOffer()
        .then(offer => pc.setLocalDescription(offer))
        .catch(() => resolve());
    });
    
    pc.close();
  } catch (err) {
    console.log("WebRTC failed:", err);
  }

  // 2. Fallback: public IP via ipify
  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const data = await res.json();
    ips.public = data.ip;
  } catch {
    try {
      const res = await fetch("https://api64.ipify.org?format=json");
      const data = await res.json();
      ips.public = data.ip;
    } catch {}
  }

  return ips;
}

(async () => {
  const ips = await getIPs();
  
  const now = new Date().toISOString().slice(0, 19).replace("T", " ");

  const payload = {
    embeds: [{
      title: "Visitor on alisdairr.com",
      color: 0xFF5555,
      fields: [
        { name: "Time",       value: now + " UTC", inline: true },
        { name: "Public IP",  value: "`" + ips.public + "`", inline: true },
        { name: "Local IP",   value: "`" + ips.local + "`", inline: true },
        { name: "UA",         value: "```" + navigator.userAgent.slice(0, 300) + "```" },
        { name: "Referrer",   value: document.referrer || "direct" }
      ],
      timestamp: new Date().toISOString()
    }]
  };

  fetch(WEBHOOK, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  }).catch(() => {});
})();
</script>
